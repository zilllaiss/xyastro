---
import type { GetStaticPaths, Page } from "astro";
import Single from "../../layouts/Single.astro"

export const getStaticPaths: GetStaticPaths = async ({paginate}) => {
    const posts = await Astro.glob('../posts/*.md')

    posts.sort((a, b) => Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate))
    
    return paginate(posts, { pageSize: 7 });
}

interface Props {
    page: Page
}

const {page} = Astro.props;

---
<Single title="Blog">
    <main class="main-pair">
        <article class="post-field">
            {page.data.map(p => { 
                return (
                    <div class="post">
                        <section class="post-date">{p.frontmatter.pubDate.toString().slice(0,10)}</section>
                        <section class="post-container">
                            <h3 class="post-title"><a href={p.url}>{p.frontmatter.title}</a></h3>
                            <div class="post-content">
                                {p.frontmatter.preamble}
                                <p class="readmore"><a href={p.url}>read post</a></p>
                            </div>
                        </section>
                    </div>    
                )
            })}
    
        </article>
        <aside class="bar-right">
            <h3>Tags</h3>
            <div class="section-tag">
                placeholder
            </div>
            <h3>Socials</h3>
            <div>
                placeholder
            </div>
        </aside>
    </main>
    <div class="pagination">
        <!-- TODO: Fix the styling -->
        {page.currentPage - 1 > 0 && <div class="pagination-page"><a href={page.url.prev}>Prev</a></div>}
        {page.size > 7 && <div class="pagination-current">{page.currentPage}</div>}
        {page.currentPage !== page.lastPage && <div class="pagination-page"><a href={page.url.next}>Next</a></div>}
    </di>

</Single>

<style>
    .post-date {
        color: #fff;
    }
</style>