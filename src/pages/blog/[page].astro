---
import type { GetStaticPaths, Page } from "astro";
import SingleNoH2 from "../../layouts/SingleNoH2.astro"

export const getStaticPaths: GetStaticPaths = async ({paginate}) => {
    const posts = await Astro.glob('../posts/*.md')

    posts.sort((a, b) => Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate))
    
    return paginate(posts, { pageSize: 7 });
}

interface Props {
    page: Page
}

const {page} = Astro.props;

---
<SingleNoH2 title="Blog">
    <div class="header-container">
        <h2>Blog</h2>
    </div>
    <main class="main-pair">
        <article class="post-field">
            {page.data.map(p => { 
                return (
                    <div class="post">
                        <section class="post-date">{p.frontmatter.pubDate.toString().slice(0,10)}</section>
                        <section class="post-container">
                            <section class="post-header">
                                <h3 class="post-title"><a href={p.url}>{p.frontmatter.title}</a></h3>
                                {p.frontmatter.tags && <div>{p.frontmatter.tags.map(t => <span class="tag"><a href={`tags/${t}`}>{t}</a></span>)}</div>}
                                <p>{p.frontmatter.preamble}</p>
                                {p.frontmatter.image && <img src={p.frontmatter.image.url} alt={p.frontmatter.image.alt}></img> }
                                <p class="readmore"><a href={p.url}>...read post</a></p>
                            </section>
                        </section>
                    </div>    
                )
            })}
        </article>
        <aside class="bar-right">
            <h3>Tags</h3>
            <div class="section-tag">
                placeholder
            </div>
            <section class="icon">
                <h3>Find me on:</h3>
                <div class="icon-container">
                    <a href="https://github.com/zilllaiss/"><img class="icon-small" src="/icons/github.svg" alt="github">github.com/zilllaiss/</a>
                </div>
                <div class="icon-container">
                    <img class="icon-small" src="/icons/discord.svg" alt="discord"><span>zill_laiss</span>
                </div>
            </section>
        </aside>
    </main>
    <div class="pagination">
        {page.currentPage - 1 > 0 && <div class="pagination-page"><a href={page.url.prev}>Prev</a></div>}
        {page.size > 7 && <div class="pagination-current">{page.currentPage}</div>}
        {page.currentPage !== page.lastPage && <div class="pagination-page"><a href={page.url.next}>Next</a></div>}
    </di>

</SingleNoH2>

<style lang="scss">
    .header-container {
        h2 {
            width: 1206px;
        }
    } 

    .post-date {
        color: #fff;
    }
</style>